{% if module.rosary_ == true%}
<div class="virtual-chappel-btn-container">
    <div class="titleAndTime">
        <p>{{ module.title }} </p>
        <span class="dAndT"> - {{ module.date_and_time }}</span>
        <span class="live-label">Live</span>
    </div>
    <div class="schedule-btn">
        <a id="schedule-btn-anchor" href="https://prayer.shalomworld.org/presidential-election/24-hour-rosary-schedule">
            View Schedule
        </a>
    </div>
</div>
{% else %}
<!-- <div class="virtual-chappel">
    <h1>{{ module.title }}</h1>
</div> -->
{% endif %}
<!-- Countdown Wrapper -->
<div class="wrapper_video" id="countdown-wrapper" style="display: none;">
    
    <div id="countdown" class="timer">
        <h2>BEGINNING IN</h2>
        <div>
            <div class="countdown-segment">
                <span id="days"></span>
                <small>Days</small>
            </div>
            <div class="countdown-segment">
                <span id="hours"></span>
                <small>Hours</small>
            </div>
            <div class="countdown-segment">
                <span id="minutes"></span>
                <small>Mins</small>
            </div>
            <div class="countdown-segment">
                <span id="seconds"></span>
                <small>Secs</small>
            </div>
        </div>
    </div>
</div>

<!-- Video Player -->
<div class="player_container__" id="video-player"
    style="visibility: hidden; background-color: transparent;  display:none;">
    {{ module.embed_code }}
</div>
<!-- {{ module.date_and_time }} -->
{% require_js %}
<script async>
            // Get current time in ET (Eastern Time)
            function getEasternTime() {
                const now = new Date();

                // Format the date to the 'America/New_York' timezone (ET)
                const formatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: 'America/New_York',
                    hour12: false,
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                const parts = formatter.formatToParts(now);
                const values = Object.fromEntries(parts.map(p => [p.type, p.value]));

                // Create a Date object in ET using the extracted parts
                return new Date(
                    `${values.year}-${values.month}-${values.day}T${values.hour}:${values.minute}:${values.second}-04:00`
                );
            }

    const targetDateEST = new Date("{{ module.date_and_time }}").toLocaleString("en-US", {
        timeZone: "America/New_York",
    });
    const targetDate = new Date(targetDateEST).getTime();

    const countdownInterval = setInterval(function () {
        const now = new Date().getTime();
        const distance = targetDate - getEasternTime()

        if (distance > 0) {
            // Show countdown when it's time to start it
            document.getElementById("countdown-wrapper").style.display = "block";
            // document.getElementById("loader").style.display = "block";
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("days").textContent = days;
            document.getElementById("hours").textContent = hours;
            document.getElementById("minutes").textContent = minutes;
            document.getElementById("seconds").textContent = seconds;
        }

        if (distance < 0) {
            clearInterval(countdownInterval);
            // Hide countdown and show video player
            document.getElementById("countdown-wrapper").style.display = "none";
            const videoPlayer = document.getElementById("video-player");
            videoPlayer.style.visibility = "visible";
            videoPlayer.style.display = "block";
            videoPlayer.style.position = "static";
        }

    }, 1000);
</script>
{% end_require_js %}
