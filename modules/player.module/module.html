{% if module.rosary_ == true%}
<div class="virtual-chappel-btn-container">
    <div class="titleAndTime">
        <p>{{ module.title }} </p>
        <span class="dAndT"> - {{ module.date_and_time }}</span>
        <span class="live-label">Live</span>
    </div>
    <div class="schedule-btn">
        <a id="schedule-btn-anchor" href="https://prayer.shalomworld.org/presidential-election/24-hour-rosary-schedule">
            View Schedule
        </a>
    </div>
</div>
{% else %}
<!-- <div class="virtual-chappel">
    <h1>{{ module.title }}</h1>
</div> -->
{% endif %}
<!-- Countdown Wrapper -->
<div class="wrapper_video" id="countdown-wrapper" style="display: none;">
    
    <div id="countdown" class="timer">
        <h2>BEGINNING IN</h2>
        <div>
            <div class="countdown-segment">
                <span id="days"></span>
                <small id="days-text">Days</small>
            </div>
            <div class="countdown-segment">
                <span id="hours"></span>
                <small>Hours</small>
            </div>
            <div class="countdown-segment">
                <span id="minutes"></span>
                <small>Mins</small>
            </div>
            <div class="countdown-segment">
                <span id="seconds"></span>
                <small>Secs</small>
            </div>
        </div>
    </div>
</div>

<!-- Video Player -->
<div class="player_container__" id="video-player"
    style="visibility: hidden; background-color: transparent;  display:none;">
    {{ module.embed_code }}
</div>
{% require_js %}
<script async>

time_{{ mod_name }} = "{{ module.date_and_time_value }}";
year_{{ mod_name }} = time_{{ mod_name }}.substring(0, 4);
month_{{ mod_name }} = time_{{ mod_name }}.substring(5, 7);
day_{{ mod_name }} = time_{{ mod_name }}.substring(8, 10);
hour_{{ mod_name }} = time_{{ mod_name }}.substring(11, 13);
minute_{{ mod_name }} = time_{{ mod_name }}.substring(14, 16);
seconds_{{ mod_name }} = time_{{ mod_name }}.substring(17, 19);


function getTimeOffset(timezoneTime="UTC-04:00") {
[sign, hours, minutes] = timezoneTime.split(/(UTC[+-])(\d{2}):(\d{2})/).filter(Boolean);
offsetHours = parseInt(hours, 10);
offsetMinutes = parseInt(minutes, 10);
decimalOffset = offsetHours + offsetMinutes / 60;
finalOffset = sign === "UTC-" ? -decimalOffset : decimalOffset;

return finalOffset;
}
const nextYear_{{ mod_name }} = new Date().getFullYear() + 1;
const userTimezoneOffset_{{ mod_name }} = -new Date().getTimezoneOffset();
const ownerTimezoneOffset_{{ mod_name }} = getTimeOffset() * 60;
const timezoneOffset_{{ mod_name }} = (userTimezoneOffset_{{ mod_name }} - ownerTimezoneOffset_{{ mod_name }}) * 60000;
var isSafari = /^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);
if (isSafari) {
    newYearTime_{{ mod_name }} = new Date(year_{{ mod_name }} + "-" + month_{{ mod_name }} + "-" + day_{{ mod_name }} + " " + hour_{{ mod_name }} + ":" + minute_{{ mod_name }} + ":" + seconds_{{ mod_name }});
} else {
    newYearTime_{{ mod_name }} = new Date(month_{{ mod_name }} + " " + day_{{ mod_name }} + " " + year_{{ mod_name }} + " " + hour_{{ mod_name }} + ":" + minute_{{ mod_name }} + ":" + seconds_{{ mod_name }});
}

            {# // Get current time in ET (Eastern Time)
            function getEasternTimeAsDate() {
            const utcTime = new Date(); // Current UTC time

            // Determine if we are in Daylight Saving Time (DST)
            const isDST = (date) => {
                // Check if the date is in the DST range for New York
                const january = new Date(date.getFullYear(), 0, 1); // January 1st
                const july = new Date(date.getFullYear(), 6, 1); // July 1st
                const dstOffset = Math.max(january.getTimezoneOffset(), july.getTimezoneOffset()); // Determine offset
                return date.getTimezoneOffset() < dstOffset; // If current offset is less than max offset, it's DST
            };
        
            // Get current time in Eastern Time (EDT/EST)
            const easternOffset = isDST(utcTime) ? -4 : -5; // EDT is -4, EST is -5
            const easternTime = new Date(utcTime.getTime() + (easternOffset * 60 * 60 * 1000)); // Convert UTC to Eastern Time
        
            return easternTime;
        }

    const targetDateEST = new Date("{{ module.date_and_time_value }}")
    const targetDate = targetDateEST.getTime();
console.log(getEasternTimeAsDate()) #}
    const countdownInterval = setInterval(function () {
    currentTime_{{ mod_name }} = new Date();
    let distance = newYearTime_{{ mod_name }} - (currentTime_{{ mod_name }} - timezoneOffset_{{ mod_name }});

        if (distance > 0) {
            // Show countdown when it's time to start it
            document.getElementById("countdown-wrapper").style.display = "block";
            // document.getElementById("loader").style.display = "block";
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("days").textContent = days;
            document.getElementById("hours").textContent = hours;
            document.getElementById("minutes").textContent = minutes;
            document.getElementById("seconds").textContent = seconds;
        }

        if (distance < 0) {
            clearInterval(countdownInterval);
            // Hide countdown and show video player
            document.getElementById("countdown-wrapper").style.display = "none";
            const videoPlayer = document.getElementById("video-player");
            videoPlayer.style.visibility = "visible";
            videoPlayer.style.display = "block";
            videoPlayer.style.position = "static";
        }
        if(days%2 == 0){
        document.quertSelector("#countdown #days-text").textContent = "Days";
        }
        else{
        document.quertSelector("#countdown #days-text").textContent = "Day";
        }
    }, 1000);

</script>
{% end_require_js %}
